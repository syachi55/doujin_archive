
## works.status 再設計

本システムにおける works.status は、同人作品フォルダの処理フロー全体における進行状況の記録・制御インジケーターである。
従来は用途や分類軸が混在していたが、今後の自動化・レビュー補助・検索性強化に向けて以下のように再設計する。

---

### 🚦 再設計された status 値一覧（正式）

| `status`    | 意味・状態の定義                                                                               |
| ----------- | -------------------------------------------------------------------------------------- |
| `pending`   | DB登録直後。未分類・未解析の初期状態。<br>過去に付与されていた `skip`（画像1枚）・`fragment`（画像2～5枚）も本ステータスに統合。          |
| `parsed`    | 正規表現により構文解析に成功し、`works_draft` が生成された状態。補完は未完了。                                         |
| `confirmed` | `circle_id_done`, `author_id_done`, `source_id_done`, `type_id_done` がすべて `True`。補完完了。 |
| `renamed`   | `rename.py` によりフォルダ名がリネーム済み。`works.id` を含んだ新しい一意名が付与されている。                             |
| `archived`  | フォルダの階層再配置・重複判定・不要フォルダの削除が完了し、完全アーカイブ化された最終状態。任意の終端ステータス。                              |

- ❌ 廃止：skip, fragment, parsed_partial（本設計で明確に不要と判断）

---

### 🔄 処理フローと状態遷移図（簡易）

```text
[DL後ストレージ移動]
        ↓
[DB登録] → status = pending
        ↓
[構文解析成功] → status = parsed
        ↓
[全項目補完完了]（*_id_done すべて True） → status = confirmed
        ↓
[フォルダリネーム完了] → status = renamed
        ↓
[階層再配置 + 重複整理] → status = archived
```

---

### ⚙ 状態設計の基本方針

- `status` は「進行段階のみを表現」し、分類・補完状況の混在は避ける。
- 補完状況は `*_id_done` 系の 個別フラグで管理。
- `status` は 単一カラムで管理され、状態遷移は一方向の流れを基本とする。
- 特例や再処理の柔軟性確保のため、中間状態への巻き戻しは手動操作により可とする。